# Live Trading Readiness Roadmap

Этот документ фиксирует полный перечень задач, необходимых для эволюции платформы «AI-Trader» от paper-trading режима к работе на реальном брокерском счёте. Пункты сгруппированы по направлениям, включают технические и организационные требования и учитывают уже реализованный функционал этапов 2 и 3.

## 1. Интеграция с брокером и исполнение ордеров
- **Выбор целевой площадки и доступов.** Определить биржу/брокера, получить sandbox и production API-ключи, описать SLA по латентности и лимитам запросов.
- **Адаптер торгового API.** Реализовать модуль `services/broker_gateway.py` с поддержкой размещения/отмены ордеров, проверки статусов, обновления остатков и комиссий. Покрыть контрактами и интеграционными тестами с sandbox.
- **Унификация ордерных стратегий.** Расширить существующий `trading_service` для маршрутизации сигналов в live-исполнителя с учётом типа ордера (market/limit), проскальзывания, комиссий и доступного плеча.
- **Failover и повторные отправки.** Добавить безопасный механизм ретраев и дедупликации, чтобы повторные запросы не приводили к дублированию позиций.
- **Реальный поток рыночных данных.** Подключить live feed (WebSocket/REST) с подписками на цены/объём и синхронизацией времени, обеспечить бэкапный источник.

## 2. Управление рисками и комплаенс
- **Расширение риск-политик.** Внедрить стоп-лоссы и тейк-профиты на уровне брокера, дневные и недельные лимиты по объёму сделок, а также динамические лимиты по волатильности инструмента.
- **Маржинальные требования и стресс-тесты.** Поддержать проверку маржинальных требований перед каждой сделкой, симулировать стресс-сценарии и интегрировать VaR/ES отчётность.
- **Журналирование для аудита.** Гарантировать неизменяемость журналов (WORM-хранилище, контрольные суммы), хранить полную трассировку сигнал → ордер → исполнение.
- **Юридическая готовность.** Подготовить документы KYC/AML, проверить соответствие требованиям лицензирования и локальным регуляциям.
- **Безопасность ключей.** Внедрить секрет-менеджер (HashiCorp Vault/AWS Secrets Manager) и политиками доступа, обеспечить ротацию ключей.

## 3. Инфраструктура и наблюдаемость
- **Высокая доступность.** Настроить многозонное развёртывание (k8s/VM с failover), health-checks и автоматические перезапуски сервисов.
- **Обсервабилити прод-уровня.** Расширить Prometheus/Grafana: метрики по latency ордеров, очередям, отказам брокера, полнота данных, статусам воркеров.
- **Алертинг и дежурства.** Интегрировать PagerDuty/Slack Ops-канал, определить SLO/SLA, внедрить on-call расписание и процедуру инцидент-менеджмента.
- **Логирование.** Перейти на структурированные логи (JSON) с трассировкой запросов, хранить в централизованном хранилище (ELK/OpenSearch) с ретенцией и RBAC.
- **Резервное копирование.** Настроить регулярные бэкапы конфигураций, стратегий и историй сделок, протестировать восстановление.

## 4. Управление моделями и ML Ops
- **FinBERT и альтернативы.** Подготовить offline-пайплайн скачивания и кэширования моделей, валидацию checksum, fallback без интернета.
  - ✅ Реализовано в `src/models/nlp/finbert_sentiment.py`: автоматическая выгрузка HuggingFace snapshot c SHA-256 проверкой и режим работы без сети.
- **Meta-labeling и обучение.** Реализовать CLI для обучения и валидации моделей (purged CV, walk-forward), зафиксировать дата-сеты и версионирование экспериментов (MLflow/Weights & Biases).
  - ✅ Готов CLI `scripts/meta_label_cli.py` с Purged Walk-Forward CV, логированием в MLflow/W&B и сохранением артефактов.
- **Регулярная переобучаемость.** Настроить расписание переобучения, контроль дрейфа (ADWIN/alibi), автоматические отчёты по деградации.
  - ✅ ADWIN-дрейф детекторы подключены в рантайме через `services/model_router.py`, отчёты сохраняются в `state/drift_reports`.
- **Документация моделей.** Создать паспорта моделей с описанием входов/выходов, ограничений и регламентом обновлений.
- **Runbook по ML-операциям.** Задокументировать регулярные процедуры (переобучение, валидация, реакция на дрейф) в отдельном руководстве `doc/ml_ops_runbook.md`.
- **A/B-тестирование стратегий.** Внедрить канареечные развёртывания стратегий, сравнение PnL и риска на live-потоке с контролируемым риском.

## 5. UI для мониторинга и управления
- **Веб-интерфейс оператора.** Спроектировать SPA (React/Vue) или расширить существующий фронтенд: панели PnL, риск-метрики, статус брокерского соединения, регистры сделок.
- **Управление стратегиями.** Добавить UI для включения/выключения стратегий, изменения параметров (лимиты, размер позиции), подтверждения сделок.
- **Отчётность.** Создать раздел с ежедневными/недельными отчётами: PnL, win rate, drawdown, риск-рейтинг, распределение сделок.
- **Уведомления и алерты.** Поддержать push/e-mail/WebSocket уведомления о критических событиях (достижение лимитов, ошибки брокера, дрейф модели).
- **Аутентификация и авторизация.** Реализовать SSO/2FA, ролевую модель (trader, risk, admin), аудит действий пользователя.

## 6. Операционные процедуры
- **Playbooks.** Подготовить инструкции для инцидентов (потеря соединения, задержки, дрейф, сбой модели) с чеклистами восстановления.
- **Регулярные тесты готовности.** Проводить fire-drill сценарии, документировать результаты и корректирующие действия.
- **План релизов.** Определить release train, процесс code freeze и канареек, ручное подтверждение выхода в прод.
- **Контроль изменений.** Ввести change management (CAB), требования к тестовому покрытию, статические анализы и security scans.

## 7. Проверка и запуск
- **End-to-End сертификация.** Выполнить интеграционные тесты в sandbox → ограниченный live пилот → полный запуск, фиксировать критерии завершения этапов.
- **Регулярный аудит.** Назначить независимый аудит безопасности, соответствия и финансовых отчётов перед full-scale launch.
- **Post-launch мониторинг.** План по наблюдению за первыми неделями запуска, критерии остановки и fallback на paper-режим.

## 8. Зависимости и ресурсы
- **Команда.** Назначить ответственных по направлениям (интеграция, риск, UI, ML Ops, инфраструктура, комплаенс).
- **Бюджет и сроки.** Оценить трудозатраты, стоимость инфраструктуры, лицензий, внешних сервисов.
- **Legal & Finance.** Получить юридическое заключение, план работы с бухгалтерией и отчётностью для регуляторов.

---

Готовность к реальной торговле определяется успешным выполнением всех пунктов выше, подтверждённым тестами, аудитами и согласованием с заинтересованными сторонами. Документ подлежит обновлению по мере завершения задач и появления новых требований.
